\chapter{Implementierung in VHDL}
\label{c:vhdl}
\section{Einführung in VHDL}
In diesem Abschnitt soll eine kurze Einführung in VHDL gegeben werden, damit die
nachfolgende Erklärung der Implementierung leichter zu verstehen ist.

\subsection{Was ist VHDL}
VHDL ist eine sogenannte Hardware Description Language (HDL), mit welcher es möglich ist, digitale
Schaltungen in Form von Quellcode zu schreiben, um diesen dann von einem
Computer zu Hardware weiterverarbeiten zu lassen. VHDL ist eine Abkürzung für
VHSIC HDL (\acl{VHDL}). Der geschriebene VHDL-Code wird dann synthesiert zu
einer Netzliste, welche die einzelnen Verbindungen zwischen den Komponenten
beschreibt. Diese Netzliste wird daraufhin für den jeweiligen \ac{FPGA}
übersetzt, sodass als letzter Schritt eine Konfigurationsdatei erstellt werden
kann, welche auf den \ac{FPGA} geladen werden kann.

Eine Besonderheit bei VHDL ist, dass nicht jeder geschriebene Quellcode
synthesierbar ist, was bedeutet, dass mancher Quellcode nur in der Simulation
funktioniert. In dem Umfang dieses Projektes ist aber der geschriebene Quellcode
vollkommen synthesierbar und soll nicht nur in der Simulation funktionieren.

\subsection{Notation}
Allgemein endet jede Anweisung immer mit einem Semikolon. Kommentare werden mit
einem doppelten Bindestrich (-{}-) eingeleitet und sind gültig bis zum Ende der
Zeile. Einzelne Bitwerte werden mit einfachen Anführungszeichen und Werte
von Bitvektoren (mehreren Bits) mit doppelten Anführungszeichen umrahmt.

Außerdem gibt es noch mehrere Sprachelemente, welche häufig Verwendung
haben. Eine (nicht vollständige) Beschreibung von häufig genutzten
Sprachelementen:

\begin{description}[align=right, labelwidth=1.6cm]
\item[signal]		Verbindung zweier Module. Beschreibt die Leitung zwischen den
					Modulen.
\item[variable]		Ein Zwischenspeicher für Werte, welcher \textbf{nicht} als
					Signal übersetzt wird.
\item[entity]		Schlüsselwort zur Deklaration eines Moduls (logische Einheit).
\item[in]			Deklaration eines Eingabesignals eines Moduls.
\item[out]			Deklaration eines Ausgabesignals eines Moduls.
\item[architecture]	Schlüsselwort zur Definition eines Moduls
\item[component]	Signatur eines Moduls. Wird verwendet, um ein Modul
					innerhalb eines anderen Moduls zu verwenden.
\item[package]		Eine Sammlung (Bibliothek) von \textbf{components}.
\end{description}
\pagebreak
\section{Beschreibung wichtiger Module}
\subsection{top -- Verbindung der Ein- und Ausgänge}
\label{s:top}
Das Topmodul dient als oberste Ebene, welche die \ac{EPU} mit der `Außenwelt'
verbindet. Die dazugehörigen Ein- und Ausgangssignale werden in der Datei
\textit{top.vhdl} festgelegt.

Wie in Abbildung~\ref{code:top} zu erkennen, wird zuerst der Takt in Zeile drei als
Eingang definiert, in den Zeilen vier bis acht die 7-Segment-Anzeige, die LEDs
und Taster definiert. Die Zeilen zehn und elf beschreiben die beiden Signale des
seriellen Schnittstelle und Zeilen dreizehn bis siebzehn beschreiben die Signale
der VGA--Verbindung.
\begin{figure}[htb]
\lstinputlisting[firstline=11, lastline=29]{../vhdl/top/top.vhdl}
\caption{Topmodul}
\label{code:top}
\end{figure}
\pagebreak
\subsection{core -- Topmodul der CPU}
\label{s:core}
Das `core'-Modul verbindet die einzelnen Baugruppen der CPU\@. Dazu gehören
Rechenwerk, Steuerwerk, Dekodierer, Programmzähler und der Stack, welche bereits
in Kapitel~\ref{c:hardware} beschrieben wurden. 

In Abbildung~\ref{code:core} ist die Definition des Moduls dargestellt. Die
Signalnamen wurden dem Zweck angepasst, dass heißt das Verbindungen zum
Speichercontroller mit `MEM' und interne Signale mit `CORE' bezeichnet. Das
Signal `O\_LED' ist dabei eine Ausnahme, da dieser zu Testzwecken verwendet wird
und damit nicht fest eingeordnet werden kann.
\begin{figure}[htb]
\lstinputlisting[firstline=11, lastline=31]{../vhdl/core/core.vhdl}
\caption{`core'-Modul}
\label{code:core}
\end{figure}
\pagebreak
\subsection{memory\_control -- Speichercontroller}
\label{s:memcontrol}
Der Speichercontroller wurde bereits in Abschnitt~\ref{s:memorycontrol}
beschrieben und hier soll nur die Implementation dessen dargestellt werden.

Wie auch bei dem `core'-Modul (siehe~\ref{s:core}) sind hier die Signale nach
Zugehörigkeit bezeichnet und interne Signale mit `MEM' und Videosignale mit
`VID' beschrieben. Außerdem sind die letzten drei Signale (Zeilen 22--24) für
die serielle Schnittstelle vorgesehen, welches im Speicher abgebildet wird.
\begin{figure}[htb]
\lstinputlisting[firstline=11, lastline=36]{../vhdl/mem/memory_control.vhdl}
\caption{Speichercontroller}
\label{code:core}
\end{figure}
\pagebreak
